# 让我们动起来

在上一章节中我们可以了解到如何渲染一份静态内容，但是仅仅渲染静态内容并不能作为一个完整的框架。而在本章节内会让静态的内容动起来

## 插值表达式

在众多编译型前端框架中，如果需要在一个位置插入变量，通常会使用一对特殊的标记，在标记内的都会被作为表达式解析并运行，而这个被称之为「插值表达式」。

## 创建

让我们来看下面这个模板，模板内通过插值表达式直接将 `name` 渲染出来。

<md-code ref="02-001.html"></md-code>

在上文的基础上，我们可以很轻松的就写出如下代码

<md-code ref="02-002.ts"></md-code>

只需要调用并传入需要的值就可以渲染出正确的效果来。

在了解了最基础的渲染逻辑之后，进阶一下，如果模板里面有多个插值表达式该怎么办呢？例如

<md-code ref="02/multi-var.html"></md-code>

以此类推

<md-code diff="02-002.ts,02/multi-var.ts"></md-code>

> Question: 到目前为止，我们所有出现过的例子都是直接将变量渲染出来，此时变量就等于插值表达式，但是如果插值表达式内同时出现了多个变量，此时在设计中应该以插值表达式为单位进行渲染还是以变量为单位进行渲染

## 更新

当我们完成了创建的能力之后，更新逻辑照葫芦画瓢也能知道，只需要重新根据变量参数计算一次 `innerText` 值即可。说干就干

更新是一个独立的流程，所以需要额外添加一个新的 `update` 函数，专门用于处理和更新逻辑相关的代码，其入参为我们需要的变量值。

<md-code diff="02/multi-var.ts,02/update-multi-var.ts"></md-code>

至此，我们便可以实现让其整体动起来的目标了。

## 文本独立更新？

到目前为止，我们一直没有去说更新性能相关的逻辑，不是因为没必要，而是一直没有一个合适的切入点。在完成了上面的基础知识之后，是时候来考虑这个问题了，先来看这个例子

<md-code ref="02/more-static.html"></md-code>

此时我们就会发现，如果只考虑创建，那么只需要拼接一次字符串即可，但是如果要考虑到更新，每次都需要去拼接一段非常长的字符串，而每个字符串之间只有 `name` 这个插值发生了变化。

又因为众所周知的原因，JavaScript 中字符串是 Immutable 的，也就是说即使两个字符串中有一个字符发生了变化，他们两个也是完全独立的，独立的占据了内存空间。这就导致这种情况下，我们如果只是单纯的拼接起来，这会创建大量字符串，从而引起性能的下降。

而解决这个问题最好的办法就是能够按需修改每次发生变化的部分，恰好，DOM 提供了这个能力，可以使用对 `Text` 节点的操作代替 `innerText` 属性的赋值，从而来达到我们想要的效果。

<md-code ref="02/more-static.ts"></md-code>

<md-note type="preknowledge">

需要了解和 `Text` 相关的前置 DOM API，[点击此处](https://developer.mozilla.org/en-US/docs/Web/API/Document/createTextNode)。

</md-note>

> 虽然我们这里以效率为切入口，介绍了 Text 的使用，但不仅仅只有这一个理由，从编译的角度来说，这样细粒度的拆分也可以让编译逻辑更加纯粹。
>
> 如果不拆分，一个 `innerText` 的赋值可能就会牵扯多个变量，每个变量之间不再独立，而是有相互的影响。

## 总结

本章节内我们了解了最简单更新的方式，也考虑了多个数值的情况，从这个当中，我们也引出了如何对文本节点的拆分。

可是，这个例子仅仅到这里就结束了么？不，并不是，眼尖的小伙伴或许已经发现了端倪，如果我们有几百上千个变量，即使其中一个发生了变化，都会导致 `update` 函数被执行，导致所有相关的表达式被更新。

而这个也正是我们下一章节所要设计的，Changes，变更检查。

## 思考

1. 当需要绑定多个变量的情况下，还能有什么办法呢？
