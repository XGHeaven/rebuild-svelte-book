# 多，再多一点

在前文中我们已经了解如何让整个界面动起来，而实际情况可能远远要比这个复杂。
对于一个界面来说，影响其结果的可能不仅仅只有一个变量，而是有多个，而如何处理这多个变量之间的关系以及性能变成为本章节所要探讨的东西。

## 多，多，再多一点

前文的例子中，只是介绍了最简单的一个变量的情况，但实际往往不可能只有一个变量，例如下面这个秒表的例子。

<md-code ref="./multi-var.html"></md-code>

这个模板中存在三个变量，分别是小时 `h`、分钟 `m`、秒 `s`。
每经过一秒钟，时钟上的数字都会向前前进。

按照我们之前的思路，想要写出对应代码也是非常简单的，只需要多加几个入参就可以了。

<md-code diff="02/simple-update.ts,./multi-var.ts"></md-code>

## 数组输入

虽然上面的例子可以完整的渲染出模板所对应的效果，但从编码的哲学来看这样设计是非常不合理的。
最简单的优化方式便不是通过入参个数注入，而是通过将所有的变量封装在一个数组里面来实现。

<md-code diff="./multi-var.ts,./use-array.ts"></md-code>

## 文本独立更新？

到目前为止，我们一直没有去说更新性能相关的逻辑，不是因为没必要，而是一直没有一个合适的切入点。在完成了上面的基础知识之后，是时候来考虑这个问题了，先来看这个例子

<md-code ref="02/more-static.html"></md-code>

此时我们就会发现，如果只考虑创建，那么只需要拼接一次字符串即可，但是如果要考虑到更新，每次都需要去拼接一段非常长的字符串，而每个字符串之间只有 `name` 这个插值发生了变化。

又因为众所周知的原因，JavaScript 中字符串是 Immutable 的，也就是说即使两个字符串中有一个字符发生了变化，他们两个也是完全独立的，独立的占据了内存空间。这就导致这种情况下，我们如果只是单纯的拼接起来，这会创建大量字符串，从而引起性能的下降。

而解决这个问题最好的办法就是能够按需修改每次发生变化的部分，恰好，DOM 提供了这个能力，可以使用对 `Text` 节点的操作代替 `innerText` 属性的赋值，从而来达到我们想要的效果。

<md-code ref="02/more-static.ts"></md-code>

<md-note type="preknowledge">

<md-note-title link="https://developer.mozilla.org/en-US/docs/Web/API/Document/createTextNode">

`Text` 与 `createTextNode`

</md-note-title>

在 DOM 的体系中，通常我们可以认为文字是某一个元素的属性（例如通过 .innerText 获取内容文本），但是文字本身也是一个节点，只不过这个节点比较特殊，它不是 Element 而是 Node，这也就意味着它通常无法被 `children` 属性所获取到。这也就是为什么大家对这个的存在感这么低的原因。

要想获取某个 Element 下的文本节点，只能通过 `childNodes` 属性获取，而且一旦用户更新 `innerText` 属性，不论文字节点的个数和状态，都会被强制重置成一个文字节点。所以文本节点是脆弱的，但是在这个场景下，它又是强大的。

由于文字节点不是 Element，而是 Node，所以无法通过 `innerText` 这个 Element 专有的 API 更新内容，只能通过标准的 `textContent` API 来操作文本节点。

扩展：除了文本节点外，注释节点也属于 Node。注释节点的性质和文本节点性质基本一致。

</md-note>

> 虽然我们这里以效率为切入口，介绍了 Text 的使用，但不仅仅只有这一个理由，从编译的角度来说，这样细粒度的拆分也可以让编译逻辑更加纯粹。

## 思考

1. 当需要绑定多个变量的情况下，还能有什么办法呢？
